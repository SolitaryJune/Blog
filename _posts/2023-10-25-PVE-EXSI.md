---
layout:     post
title:      "自建实体服务器"
subtitle:   "PVE，ESXi，直通，iDRAC"
date:       2023-10-25
update:     2023-11-03
author:     "elmagnifico"
header-img: "img/bg7.jpg"
catalog:    true
tobecontinued: false
tags:
    - PVE
    - ESXi
    - VPS
---

## Foreword

打算自建服务器，完成一些内部的测试和使用，有些东西也需要内部验证，一些管理软件也都需要一个内部平台。



## 硬件选型

成本考虑，1手最新服务器买不起，所以上个老服务器，能用就行了，水平其实差不多的。

- 机柜 Dell R7525
- CPU 7H12*2
- 内存 64G*12
- 硬盘 7.68T*1
- 阵列卡H745卡
- 电源 双电2400w

价格26760 不含税



## 安装

有了服务器自然还需要机柜，又增加了一个80x60x100的机柜

![image-20231103220519471](https://img.elmagnifico.tech/static/upload/elmagnifico/202311032205595.png)



服务器一般可以使用拖板拖住服务器，也可以使用滑轨方便抽拉。

- 滑轨又分静态和动态的，静态只能抽出来10cm左右，动态的可以完全抽出来

![image-20231103222357103](https://img.elmagnifico.tech/static/upload/elmagnifico/202311032223153.png)



有了这些还不够，还需要电源，一般都是使用PDU类型的电源

![image-20231103221018877](https://img.elmagnifico.tech/static/upload/elmagnifico/202311032210912.png)

- 注意总功率，一般可能单电源就2400w了，双电源就4800w，多台服务器，这个数量就上去了
- 接头高功率都是单独引线过来的，不能直接用默认的线材



## 风扇

服务器启动真的是飞机起飞，就跟涵道电机一样，呜呜的

想要服务器声音小一点，可以通过DELL的设置，直接修改风扇速率

风扇可以通过iDRAC的API进行控制，下面是一个通用的控制工具

> https://github.com/cw1997/dell_fans_controller



![image-20231103223743182](https://img.elmagnifico.tech/static/upload/elmagnifico/202311032237223.png)



这里有更高级的版本，可以独立控制每个风扇

> https://github.com/zzccchen/DellEmcFansController



使用风扇控制需要开始IPMI，具体操作在这里

>  https://zhuanlan.zhihu.com/p/157796567



顺带看了下，他还写了一个温度和内存监控程序，也挺好的

> https://github.com/zzccchen/DellEMCThermalMonitor



## iDRAC

Integrated Dell Remote Access Controller (iDRAC) 专为实现安全的本地和远程服务器管理而设计，可帮助 IT 管理员随时随地部署、更新和监视戴尔 PowerEdge 服务器。

iDRAC也要一个独立网线接入，接入以后就可以进入服务器远程访问和操作

- 远程开关机：在iDRAC Web界面或命令行界面中，管理员可以实现服务器的远程开关机、重启和冷启动等操作。
- 远程监控：iDRAC可以提供服务器的实时监控信息，包括温度、风扇速度、硬盘健康状态等，帮助管理员及时发现和解决潜在问题。
- 日志查看：iDRAC记录了服务器的事件和日志信息，管理员可以查看这些日志以进行故障排除和问题分析。
- 虚拟媒体：通过iDRAC，管理员可以将本地计算机上的光盘或ISO映像文件连接到服务器，实现虚拟媒体的加载和启动。

iDRAC也有API接口，可以用python之类的语言写一些自动化管理的脚本



## 系统虚拟化

有了硬件基础以后，还需要一个好用的系统方便做虚拟化，想折腾就上PVE，想稳定就用ESXi



### PVE

PVE，全称Proxmox Virtual Environment，虚拟机内核是KVM，主要还是Linux系统，扩展能力很强，对应要求操作的人也很高



### ESXi

ESXi是VMWare旗下的虚拟化组件之一，界面比较清晰，简单易用，扩展性差一些。

VMWare系列用的比较多的话，实际创建虚拟机之类的操作都非常类似，简单好用。



### 硬件直通

简单说，就是如果虚拟化会严重损失硬件性能，比如显卡、硬盘、网卡等，为了防止损失，所以可以指派某些硬件和虚拟机构成硬件直通，这样可以最大程度利用硬件性能。



目前普遍看到的是ESXi硬件直通大概率会遇到点问题，需要找到各种解决办法才行，PVE的硬件直通大部分都可以配置好以后直接使用。



## Summary



## Quote

> https://blog.csdn.net/weixin_42930696/article/details/128642633
>
> https://post.smzdm.com/p/aqm7d5pk/
>
> https://it.sohu.com/a/706181660_121748409
>
> https://www.python100.com/html/NX4HDQ8854F9.html
>
> https://jingyan.baidu.com/article/5d6edee2004690d8eadeec8a.html
>
> https://zhuanlan.zhihu.com/p/157796567

