---
layout:     post
title:      "DMX512灯光协议"
subtitle:   "c++"
date:       2021-01-15
author:     "elmagnifico"
header-img: "img/led.jpg"
catalog:    true
tags:
    - Embedded

---

## Foreword

最近了解了一下led灯带相关内容，顺便记录一下DMX协议学习过程



## DMX512

DMX是协议名称，后面的数字表示该协议携带的最大数据帧数量

比如DMX256，DMX512，DMX1024



#### 协议格式

![image-20210115153136343](https://i.loli.net/2021/01/15/5tgU2Klz3FxbDPq.png)



DMX512，使用的波特率是250Kbps

一个完整的DMX512数据包的格式由一个MTBP信号、一个BREAK信号、一个MAB信号和一个SC信号，以及后面的数据帧组成。其分别的含义如下：

- MTBP（Mark Time Between Packages）标志着一个完整的DMX512数据包的发送完毕，高电平有效，表示当前传输线处于空闲状态，没有数据传输。

- BREAK 是一个DMX512数据包的起始控制信号，对应着一个数据包结束后的复位阶段，复位完成后接着应该发送下一包的数据。协议规定BREAK的信号为低电平有效，并且持续时间不小于两个DMX512的数据帧的长度，即88us。

- MAB（Mark After Break）是一个数据包开始发送的标识，由于每一个数据帧的第一个位为低电平，故为了区分BREAK的低电平和数据帧的起始位的低电平，加入了MAB信号。协议规定了MAB的典型持续时长为8us，即两个位的时间，高电平有效。

- SC（Start Code）SC即起始码，它和一个普通的数据帧一样，但是它的8位数据位均为零，标示数据包中数据帧的开始。
- 数据帧，包含灯光的控制信号



#### 数据帧

一个数据帧有11bits，其中第一bit是起始位，后接8bits数据位，最后还有2bit停止位，无校验。

![img](https://i.loli.net/2021/01/15/5HteEf214Vv8QKj.png)

由于波特率已经确定了，所以每bit时间->每帧数据时间也就规定好了



#### 问题

比如DMX512，也就是最多512个数据，每个数据1字节，而控一个RBG灯至少要3个字节，那么一个完整的控制链最多能控制170个RGB灯；由于波特率固定了，那么灯的刷新频率大概是44Hz。

同时由于电气限制，大概一条DMX控制线，能控制的范围大概是1000m，超过了就需要放大器或者中继了，如果连的长了，那么频率自然就继续下降了。

DMX协议本身不带校验位，这就会出现一旦发错了，那么最后结果错了就按照错的显示了，这也是不安全的地方。



## Summary

以上是基于标准DMX来说的，实际使用的时候可能很多人会使用非标准DMX，会去掉协议的MTBP和BREAK这些内容（这个部分要单独拉低或者拉高对于现成外设不友好），只保留数据帧这部分，无数据就直接拉高，然后可以直接使用现成的控制器直接完成。



## Quote

> https://blog.csdn.net/qq_42992084/article/details/98525578
>
> https://blog.csdn.net/hushiganghu/article/details/108682690
>
> https://blog.csdn.net/cunlingwang/article/details/6712187

