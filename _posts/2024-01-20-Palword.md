---
layout:     post
title:      "Palworld幻兽帕鲁专业服务器搭建"
subtitle:   "steam、宝可梦"
date:       2024-01-20
update:     2024-01-21
author:     "elmagnifico"
header-img: "img/z7.jpg"
catalog:    true
tobecontinued: false
tags:
    - Palword
---

## Foreword

幻兽帕鲁，宝可梦版方舟，还缝合了一点塞尔达，The Survivalists，有意思，啥时候GF能做个这样的宝可梦游戏啊



本身支持小服务器4人联机，也支持大服务器32人联机，刚好有独立服务器，可以开一个玩一下。



## 服务器需求

![image-20240120154407599](https://img.elmagnifico.tech/static/upload/elmagnifico/202401201544813.png)

- CPU，4cores
- RAM，8G
- Network，Port UDP 8211
- 硬盘，50G



这是推荐配置，我直接8c，16g，防止出问题，使用Ubuntu来安装

- 后面发现12个人内存16g就满了，后续扩展到了32g



## linux



首先安装steamcmd

```
sudo add-apt-repository multiverse; sudo dpkg --add-architecture i386; sudo apt update
sudo apt install steamcmd
```



安装PalServer

```
steamcmd +login anonymous +app_update 2394010 validate +quit
cd ~/Steam/steamapps/common/PalServer
./PalServer.sh
```



路由上开放UDP端口8211即可



### 常见问题



#### 连不上steam

安装PalServer可能会一直重试，最后失败，这是由于连不上steam，所以服务器最好挂个代理

```
Loading Steam API...dlmopen steamservice.so failed: steamservice.so: cannot open shared object file: No such file or directory
Connecting anonymously to Steam Public...Retrying. . . 
Retrying. . . 
Retrying. . . 
Retrying. . . 


FAILED (No Connection)
```





修改默认网关，走透明代理，我这里自己的网关

```
route add default gw 192.168.6.232
```



恢复网关

```
route add default gw 192.168.6.1
```



挂上透明代理以后，正常安装了



#### 缺少sdk



第一次运行`./PalServer.sh`大概率会出现类似的错误

```
/home/el/.steam/sdk64/steamclient.so: cannot open shared object file: No such file or directory
[S_API] SteamAPI_Init(): Sys_LoadModule failed to load: /home/el/.steam/sdk64/steamclient.so
```

安装一下相关的sdk

```
mkdir -p ~/.steam/sdk64/
steamcmd +login anonymous +app_update 1007 +quit
cp ~/Steam/steamapps/common/Steamworks\ SDK\ Redist/linux64/steamclient.so ~/.steam/sdk64/
```

就恢复正常了



#### 缺少steamclient.so

第二次运行`./PalServer.sh`，可能会提示`steamclient.so`找不到，这个问题可以忽略，实际上找到了

```
$ ./PalServer.sh
Shutdown handler: initalize.
Increasing per-process limit of core file size to infinity.
dlopen failed trying to load:
steamclient.so
with error:
steamclient.so: cannot open shared object file: No such file or directory
[S_API] SteamAPI_Init(): Loaded '/home/ubuntu/.steam/sdk64/steamclient.so' OK.  (First tried local 'steamclient.so')
```



其他可能服务器太老了，包没更新之类的问题

```
sudo apt update
sudo add-apt-repository --remove ppa:whatever/ppa
sudo apt install steam
sudo apt-get -f install
```



#### 设置服务器密码反而进不去

设置服务器密码以后，只能通过游戏内服务器列表或者是历史游戏记录中进入，那样才有输入密码的提示框

直连IP或者域名反而没有任何提示框，会导致提示没有输入密码而进不去





#### 其他人都能正常进入，但是某些玩家进不去

> [BUG]服务器会有玩家随机坏档案，导致无法进入服务器
> 具体触发情况未知，会导致玩家UID变成00000000，然后这个玩家就再也进不了服务器了
> 网络问题排除过，服务端也重启了，游戏也重启了，必须删除这个玩家的档案才可以恢复进服

其他人都能正常进入，但是某些玩家进不去，这个是坏档问题，需要找到有问题的玩家存档，并且删除他的存档，重启服务器，然后他就能正常进入了，不过这样会造成他丢档，要重新玩



出现这个问题，需要这个玩家自己建立服务器，并且创建人物，然后去查找他的ID是什么，这个ID在自己服和别人服是相同的，通过这种方式就能定位到，不过这样太麻烦了。实际可以通过服务器快速确定。



下面的数据需要服务器管理员登录，并且查看每个人的ID，实际上自己建立服务器就能看到这个ID，进别人服务器，别的管理员也能看到这个ID

![image-20240121172909439](https://img.elmagnifico.tech/static/upload/elmagnifico/202401211729555.png)

就比如这里出问题的是xinghe，他的playerid是`2078406141`，转换成十六进制就是`7BE1F5FD`，那么存档里同名的就是他了



存档路径

```
~/Steam/steamapps/common/PalServer/Pal/Saved/SaveGames/0/随机码/Players
```



![image-20240121171728947](https://img.elmagnifico.tech/static/upload/elmagnifico/202401211717038.png)

删除以后重启服务器，这个玩家就能正常进入游戏了



## 服务器设置



#### 修改游戏设置

```
Pal/Saved/Config/LinuxServer/PalWorldSettings.ini
```

默认这个文件是空的

```
cd ~/Steam/steamapps/common/PalServer/DefaultPalWorldSettings.ini
```

但是在这里有默认设置，复制一下根据这个修改即可

```ini
; This configuration file is a sample of the default server settings.
; Changes to this file will NOT be reflected on the server.
; To change the server settings, modify Pal/Saved/Config/LinuxServer/PalWorldSettings.ini.
[/Script/Pal.PalGameWorldSettings]
OptionSettings=(Difficulty=None,DayTimeSpeedRate=1.000000,NightTimeSpeedRate=1.000000,ExpRate=1.000000,PalCaptureRate=1.000000,PalSpawnNumRate=1.000000,PalDamageRateAttack=1.000000,PalDamageRateDefense=1.000000,PlayerDamageRateAttack=1.000000,PlayerDamageRateDefense=1.000000,PlayerStomachDecreaceRate=1.000000,PlayerStaminaDecreaceRate=1.000000,PlayerAutoHPRegeneRate=1.000000,PlayerAutoHpRegeneRateInSleep=1.000000,PalStomachDecreaceRate=1.000000,PalStaminaDecreaceRate=1.000000,PalAutoHPRegeneRate=1.000000,PalAutoHpRegeneRateInSleep=1.000000,BuildObjectDamageRate=1.000000,BuildObjectDeteriorationDamageRate=1.000000,CollectionDropRate=1.000000,CollectionObjectHpRate=1.000000,CollectionObjectRespawnSpeedRate=1.000000,EnemyDropItemRate=1.000000,DeathPenalty=All,bEnablePlayerToPlayerDamage=False,bEnableFriendlyFire=False,bEnableInvaderEnemy=True,bActiveUNKO=False,bEnableAimAssistPad=True,bEnableAimAssistKeyboard=False,DropItemMaxNum=3000,DropItemMaxNum_UNKO=100,BaseCampMaxNum=128,BaseCampWorkerMaxNum=15,DropItemAliveMaxHours=1.000000,bAutoResetGuildNoOnlinePlayers=False,AutoResetGuildTimeNoOnlinePlayers=72.000000,GuildPlayerMaxNum=20,PalEggDefaultHatchingTime=72.000000,WorkSpeedRate=1.000000,bIsMultiplay=False,bIsPvP=False,bCanPickupOtherGuildDeathPenaltyDrop=False,bEnableNonLoginPenalty=True,bEnableFastTravel=True,bIsStartLocationSelectByMap=True,bExistPlayerAfterLogout=False,bEnableDefenseOtherGuildPlayer=False,CoopPlayerMaxNum=4,ServerPlayerMaxNum=32,ServerName="Default Palworld Server",ServerDescription="",AdminPassword="",ServerPassword="",PublicPort=8211,PublicIP="",RCONEnabled=False,RCONPort=25575,Region="",bUseAuth=True,BanListURL="https://api.palworldgame.com/api/banlist.txt")

```



```
Difficulty=None - Doesn't seem to matter for dedicated servers.
DayTimeSpeedRate=1.000000 - Changes how long daytime lasts.
NightTimeSpeedRate=1.000000 - Changes how long night lasts.
ExpRate=1.000000 - Modifies how much experience you get.
PalCaptureRate=1.000000 - How likely you are to capture Pals.
PalSpawnNumRate=1.000000 - How frequently Pals spawn.
PalDamageRateAttack=1.000000 - How much damage Pals do.
PalDamageRateDefense=1.000000 - How much damage Pals take.
PlayerDamageRateAttack=1.000000 - How much damage players do.
PlayerDamageRateDefense=1.000000 - How much damage players take.
PlayerStomachDecreaceRate=1.000000 - Rate at which hunger decreases.
PlayerStaminaDecreaceRate=1.000000 - Rate at which stamina decreases
PlayerAutoHPRegeneRate=1.000000 - How quickly HP will be automatically restored when hurt.
PlayerAutoHpRegeneRateInSleep=1.000000 - How much HP is regenerated while sleeping.
PalStomachDecreaceRate=1.000000 - Rate at which Pal hunger decreases.
PalStaminaDecreaceRate=1.000000 - Rate at which Pal stamina decreases
PalAutoHPRegeneRate=1.000000 - How quickly Pal HP will be automatically restored when hurt.
PalAutoHpRegeneRateInSleep=1.000000 - How much Pal HP is regenerated while sleeping.
BuildObjectDamageRate=1.000000 - Damage to objects.
BuildObjectDeteriorationDamageRate=1.000000 - How much damage built objects will take over time.
CollectionDropRate=1.000000 - Rate at which items are gathered from things like trees or rocks.
CollectionObjectHpRate=1.000000 - How much HP breakable world items have.
CollectionObjectRespawnSpeedRate=1.000000 - How quickly obects like trees respawn.
EnemyDropItemRate=1.000000 - Frequency enemies will drop items.
DeathPenalty=All - Determines what is dropped on death. Can be set to none.
bEnableAimAssistPad=True - Lets you enable or disable aim assist
bEnableAimAssistKeyboard=False - Lets you enable or disable aim assist
DropItemMaxNum=3000 - Max amount of dropped items allowed at one time.
BaseCampMaxNum=128 - Max amount of bases that can be built at once.
BaseCampWorkerMaxNum=15 - Max amount of worker Pals that can be at a camp.
DropItemAliveMaxHours=1.000000 - How long dropped items will stay spawned before disappearing.
bAutoResetGuildNoOnlinePlayers=False - If true, a guild will be disbanded if no players are online.
AutoResetGuildTimeNoOnlinePlayers=72.000000 - How quickly an inactive guild will be disbanded.
GuildPlayerMaxNum=20 - Max guild player number.
PalEggDefaultHatchingTime=72.000000 - How long it takes to hatch Pal eggs.
WorkSpeedRate=1.000000 - How quickly Pals work.
CoopPlayerMaxNum=4 - Max amount of players in a party.
ServerPlayerMaxNum=32 - Max players allowed on a server (caps at 32).
ServerName="Default Palworld Server"
ServerDescription="" - What is shown when selecting the server in the list.
AdminPassword="" - Password used to grant admin access.
ServerPassword="" - Password needed for regular players to join.
```



#### 设置密码

```
ServerPassword="123456"
```



#### 设置服务器名称

此处都可以用文中

```
ServerName="Default Palworld Server"
```



服务器描述

```
ServerDescription="点击链接加入QQ频道【elmagnifico's游戏屋】：https://pd.qq.com/s/enyor3z9m"
```



#### 人数上限

```
ServerPlayerMaxNum=32
```



#### 管理员密码

```
AdminPassword="123"
```



#### 死亡掉落

死亡全掉落

```
DeathPenalty=All
```



死亡不掉落

```
DeathPenalty=None
```



## 测试

服务器正常启动提示：

```
dlmopen steamservice.so failed: steamservice.so: cannot open shared object file: No such file or directory
Setting breakpad minidump AppID = 2394010
[S_API FAIL] Tried to access Steam interface SteamUser021 before SteamAPI_Init succeeded.
[S_API FAIL] Tried to access Steam interface SteamFriends017 before SteamAPI_Init succeeded.
[S_API FAIL] Tried to access Steam interface STEAMAPPS_INTERFACE_VERSION008 before SteamAPI_Init succeeded.
[S_API FAIL] Tried to access Steam interface SteamNetworkingUtils004 before SteamAPI_Init succeeded.

```



![image-20240120194012313](https://img.elmagnifico.tech/static/upload/elmagnifico/202401201940391.png)

服务器开久了好像FPS会下降，刚开始是60稳定的

![image-20240121143459091](https://img.elmagnifico.tech/static/upload/elmagnifico/202401211435206.png)

发现应该是和玩家数成正比的，超过4个人以后，这个FPS就开始下降了，估计20个人就10FPS了



## 正式启动

安装screen

```
apt install screen
```



使用一个独立的终端运行服务器

```
screen -S pal
```



![image-20240121035519064](https://img.elmagnifico.tech/static/upload/elmagnifico/202401210355226.png)

欢迎来玩，暂时没有设置密码

![image-20240121035626927](https://img.elmagnifico.tech/static/upload/elmagnifico/202401210356006.png)



服务器加入请使用如下地址

![image-20240121035929638](https://img.elmagnifico.tech/static/upload/elmagnifico/202401210359695.png)

```
palworld.elmagnifico.tech:8211
```



#### 管理员命令

用管理员密码登录服务器

```
/AdminPassword 密码
```

![image-20240121035813548](https://img.elmagnifico.tech/static/upload/elmagnifico/202401210358604.png)



```
显示当前玩家
/ShowPlayers
```

![image-20240121035825055](https://img.elmagnifico.tech/static/upload/elmagnifico/202401210358101.png)



其他命令类似

```
踢出
/KickPlayer [UserID]/[SteamID64]

封禁
/BanPlayer [UserID]/[SteamID64]

传送
/TeleportToPlayer {SteamID}

拉人
/TeleportToMe {SteamID}

存档
/Save

强制服务器退出
/DoExit

广播信息
/Broadcast {MessageText}

通知服务器在线玩家n秒后服务器关闭
/Shutdown {Seconds} {MessageText}
/Shutdown 120 2分钟后重启
```



## Summary

简单配好以后就可以正常游玩了



## Quote

>  https://developer.valvesoftware.com/wiki/SteamCMD#Linux
>
>  https://tech.palworldgame.com/dedicated-server-guide#windows
>
>  https://techraptor.net/gaming/guides/palworld-server-guide
>
>  https://tech.palworldgame.com/server-commands
>
>  https://tech.palworldgame.com/optimize-game-balance
>
>  https://tieba.baidu.com/p/8869855204?see_lz=0&qq-pf-to=pcqq.group

