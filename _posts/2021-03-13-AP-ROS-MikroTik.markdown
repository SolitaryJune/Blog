---
layout:     post
title:      "高带机量AP设备选型介绍"
subtitle:   "Ubnt，MikroTik"
date:       2021-03-13
update:     2021-05-28
author:     "elmagnifico"
header-img: "img/sensor-head-bg.jpg"
catalog:    true
tags:
    - AP
    - Network
---

## Foreword

这篇老文章了，设备也是老设备了，可能跟不上最新的设备了，但是选型原则，思考思路都是差不多的。

玩AP的玩家其实也挺多的，比如：

恩山无线

> https://www.right.com.cn/forum/

我自己也有斐讯K2，AC-66U，WNDR3800，也刷过梅林啊，openwrt，Lede，明月固件，Lean固件等等，折腾过不少，不过也慢慢退坑了，一个AP而已，稳定性还是最重要的，很多功能花里胡哨，其实并不实用，但是总会遇到一些有别于正常场景使用的情况，往往这方面能找到的帖子都非常少，能总结经验什么的，就更别提了，基本都是被忽悠着用的。



这里主要介绍的是如何选择高带机量AP或者是提升一个AP的最大带机量的方法，以及一些我测试过的AP具体数据，还有一些商家选择，但是大部分都能跳过。还有一些经验教训吧，这些算是我累积下来的或者从各种文档中翻到的设定。

对应的场景或者需求如下：

- 适用于客户端仅需极低带宽
- 需要极大范围覆盖，范围内遮挡较少
- 性价比极高
- 客户端稳定
- 交换机不是瓶颈



## 常识

先说一些常识性的东西，这些都是基础原则，更高带机量都是以他们为基础的。



#### 2.4G频段

如果是使用2.4网络，其网络容量比较小，协议比较老，干扰强，平常可以完全隔离的同时就只有三个频段。而且同时由于城市环境内2.4g wifi太多了，导致高峰期网络差到爆。

![](http://img.elmagnifico.tech:9514/static/upload/elmagnifico/6YpQidaZxPq5Uo4.png)



如果要使用，最好使用1，6，11，类似的三个隔离的频段，蜂窝状排布，这个是使用20MHZ带宽的情况下，其他情况干扰更严重



![](http://img.elmagnifico.tech:9514/static/upload/elmagnifico/5ca1c2e95773f.png)



同时如果选择信号所占频段越宽（20，40）本质上越容易受干扰，虽然速度上限提升了，但是传输距离下降了，干扰变大了



#### 5.8G频段

5.8G则比较优秀了，本身协议比较新，抗干扰就强一些，同时城市内5.8G wifi相对少一些，网络情况更好。同时5.8G的上限也高，最高都有160M了，横跨8个频段，非常霸道了。

而最新的Wifi6 也是在这个基础上进一步提升了无线网络的带宽和带机量。



![](http://img.elmagnifico.tech:9514/static/upload/elmagnifico/5ca1c46d38904.png)



5.8G频段划分比较好一些，本身各个频段都是完全隔离的，就算选择相邻的问题也不大，当然错开更好一些。



![](http://img.elmagnifico.tech:9514/static/upload/elmagnifico/5ca1c9e41ad0d.png)



平常的频段可能会被成为信道xxx（149，153）或者编号（36，40，44这种），这里我都以核心频率为准，有些地方允许用DFS或TPC，而有些地方可能直接不允许使用这些信道，同样在国内是否能用完全看设备，有的设备会主动屏蔽，而有的则没有。同时也又看发送端也看接收端，大家都要同时支持某一个才能用。

| 频段 | 国家           | DFS/TPC | 能否使用        |
| ---- | -------------- | ------- | --------------- |
| 5180 | united states  | 否      | 可以            |
| 5200 | united states  | 否      | 可以            |
| 5220 | united states  | 否      | 可以            |
| 5240 | united states  | 否      | 可以            |
| 5260 | no_country_set | 是      | 可以            |
| 5280 | no_country_set | 是      | 可以            |
| 5300 | no_country_set | 是      | 可以            |
| 5320 | no_country_set | 是      | 可以            |
| 5745 | no_country_set | 否      | 可以            |
| 5765 | no_country_set | 否      | 可以            |
| 5785 | no_country_set | 否      | 可以            |
| 5805 | no_country_set | 否      | 可以            |
| 5825 | no_country_set | 否      | 可以            |
| 5500 | united states  | 是      | 可以            |
| 5520 | united states  | 是      | 可以            |
| 5540 | united states  | 是      | 可以,有使用风险 |
| 5560 | united states  | 是      | 可以,有使用风险 |
| 5580 | united states  | 是      | 可以,有使用风险 |
| 5600 | united states  | 是      | 可以,有使用风险 |
| 5620 | united states  | 是      | 可以,有使用风险 |
| 5640 | united states  | 是      | 可以,有使用风险 |
| 5660 | united states  | 是      | 可以,有使用风险 |
| 5680 | united states  | 是      | 可以,有使用风险 |
| 5700 | united states  | 是      | 可以,有使用风险 |
| 5720 | united states  | 是      | 否              |



#### 协议

肯定都听过802.11a/b/g/n/ac/ax等等，2.4g这里基本上能选到最新的也就是802.11n了，5.8g这里一般都是ac，也有n和a的，wifi6的话就是ax了

协议只要ap本身没有问题，一般都是选到最新的，这种情况下各方面都比较强。



#### 带机量

并发带机量具体计算公式如下：
最大带宽 / 预留给终端设备的带宽 = 并发带机量

```
100M / 4M = 25 
```

100M的路由，每个终端给4M带宽，最多并发也就只有25个客户端了，而4M网络基本相当于2G-3G水平了，在现在的需求下面根本无法满足日常上个网的需求。

所以这也是为什么很多家用路由器直接把客户端数量直接限制在了25个，这都没算任何损耗，AP 100%性能发挥，实际上根本不可能。

当然实际上多数情况下，家庭也不可能有25个客户端同时跑，还跑满带宽的情况，所以平常的AP就足够感觉不到卡顿了。



#### 错峰交换

而要支持多客户端，错峰是必须的，本身无线CSMA/CS的底层机制就会让所有客户端监听信道，而如果所有客户端都同时发送信息自然不妥，错峰信息交换则能进一步提高带机量，不过这就需要具体的应用支持了。



#### 射频Radio

平常一个AP，可能会有多个射频模块，比如同时有2.4G和5G的，那他至少有2个Radio，各自负责一个。而做高密度覆盖的时候可能一个AP中就有4个Raido或者8个，甚至16个。但是可想而知，这样确实可以提高带机量，但是由于射频本身太过集中，功耗高的爆炸，而且自身干扰也很强。



#### 天线选择

由于使用场景不同，所以天线的需求可能也不相同，但是简单说全向是一个非常片面的词，一般多指水平方向上的全向，但是如果一旦对空或者对地覆盖的时候，经常需要垂直角度，这个时候很多天线都不达标，垂向角度非常小，从而导致实际覆盖面积很小。



内倾角：有的天线可能是直的（外表看），但是内部是弯曲了一个倾角的，多数可能都是超地面方向的 ，他们都是对地辐射的，所以调整倾角是有效的，能一定程度上改变信号情况



垂向和水平不能两全，我见过平衡二者最好的就是UBNT Outdoor5的原装天线了，国内大部分能直接买到的所谓增强wifi信号的胶棒天线或者玻璃钢天线都是不如他这个的，可惜现在也都买不到了。



#### SSID

这种级别的AP基本都支持无限开SSID，但是每一个SSID大概都会占用4-8%的信道资源，开得越多占用越多，而如果同时开20多个SSID，每个SSID下都有客户端，基本这个信道就满了，干扰特别严重。所以没有必要的话，SSID尽量少开，给信道更多的容量。



## AP商家

AP商家简直不要太多了，华为、华三、中兴、锐捷、TPLink等等，但是国内的商家太坑了，基本全都为了信噪比，直接牺牲了最大客户端数量，他们的AP里都默认设置了最大连接数量，并且是不可以解锁的，这就导致很多超低带宽设备无法同时在一个AP中。换句话说，限制了客户端数量，可以多卖几倍的设备，何乐而不为呢？



至于国内提供高密度覆盖的一些商家，比如aruba无线 ，鲲鹏无线，SUPERWIFI等等，其实他们大都是拿别人设备或者直接套壳别人设备，然后配置两下就拿出来用了。在他们的逻辑下，高密度没有增加AP数量完成不了的，但是还真的有，至少我的需求都不是增加AP能解决的。而且实际上有很多情况，由于本身没有研发能力，而且他们也只是使用设备而已，所以一些极端情况没办法处理，他们也找不到更专业的技术人员，遇到了就只能搪塞过去。



而国外的就相对良心一些，多数情况都是放开限制的，具体能不能做到就看使用者会不会用了。这就导致国外的AP性价比极高，但是门槛也高。

国外比较有名的比如Ubnt，Mikrotik，Xirrus等，他们都开放设置，一般他们都能达到远高于国内AP的带机量。



## 测评

下面是一些曾经使用过的或者测试过的设备，当然有的设备已经停产买不到了，有的只是测试过就退还了，有的是一直用了很久的。

国内的华为的或者是TP之类的都简单测过，但是由于使用目的不同，实际上他们连超过40个就明显不行了，其他厂家基本同理。



#### UniFi Outdoor5

- 理论带机量200+，目前测试最大带机量可以达到120，但是继续增加并不能行，感觉像是写死了128个。
- 理论范围183m，实际使用远超这个范围
- 5.8G走的协议是802.11n，最大只有300Mbp。



#### UniFi UAP‑AC‑SHD

- 理论带机量500+
- 测试最大带机量可以达到357，2.4g的带机量大概达到80就不行了，在有环境干扰的情况下，2.4g信道占用基本达到80%左右，就不能正常工作了。
- 适合室内使用



UniFi的AP配置比较简单，但是同时就带来了一些问题，一些设置是无法配置的



#### Cambium E700

- 最大512个用户
- IP67
- 4x4 5g
- 8dbi 天线
- 价格9600
- ARP代理，优秀
- 配置某种程度上说简单了，提前把可能的配置全配好，后期直接导入使用即可

问题：

- 性价比略低
- 供电为欧标，需要转接
- 专用供电POE，非标准
- 全英文，没有中文配置界面

这个实测大概是能达到200左右带机量



#### Cambium E500

- 最大256个用户
- 5dbi 天线
- 价格2500
- 剩下同上

问题同上，实际上这个最多只能带100左右。



#### Grandstream GWN7600LR

- 最大号称450，实际单5g带机量大概360左右，如果开启2.4g那么可能可以达到450
- 天线 5dbi 全向
- 覆盖范围500m
- 自带ac管理器，自动识别当前网络中其他设备
- 设置选项丰富，界面有中文，十分友好

问题：

- 登录复杂，url较为麻烦
- 超过200架以后有明显延迟，不能再多了。
- 启动速度很慢

这一宽他的带机量是通过拉长延迟，也就是错峰转发来提高的，所以要慎重选择。



#### MikroTik wAP ac RBwAPG-5HacT2HnD

- 理论带机量2007
- 天线2dbi 全向

问题：

- 设置复杂，全英文，没有中文
- 带机量256，没有明显延迟
- 室外可能并不行
- cpu QCA9556
- WIFI QCA9880

作为一款室内AP，性能非常BT了，带机量可以直接拉满，转发能力毫无问题，室内用非常推荐。



#### Mikrotik RBOmniTikG-5HacD

- 7.5 dbi, 全向
- 价格830
- 带机量200不稳定，开始各种掉线的情况



#### MikroTik SXTG-5HPacD-SA

- 13dbi 定向，90度天线，功率1300mW，可能强到爆炸

- 价格750

- 带机量250开始不稳定，200可以稳定

  

#### Mikrotik RBOmniTikU-5HnD

- 7.5dbi 全向天线 400mw
- 价格650
- 协议支支持到a/n 不支持ac，感觉是Mikrotik RBOmniTikG-5HacD的简配版



#### Mikrotik RBOmniTIK UPA-5HnD

- 同上，但是他是一个5层设备，授权更高一些，限制更少一些



#### Mikrotik RB921GS-5HPacD-15S

- 价格980
- 天线15dbi，120度，垂向是10度，比较小，使用时建议拉开，拉远使用
- 支持到ac/a/n
- 带机量达到336，开始出现丢包，300可以稳定

问题

- 测试结果，天线垂向范围覆盖不够，对垂向有要求的就算了。



#### Mikrotik mANTBox 19s RB921GS-5HPacD-19S

- 同上，但是支持到10km，可以认为是定向天线
- 价格1350



#### Mikrotik RB912UAG-5HPnD-OUT

- 需要另配天线，性能不明显
- 只支持到a/n
- 价格650



#### NetMetal 5SHP triple和NetMetal 5 triple

- cpu QCA9557
- WLAN QCA 9880
- 带机量600+，非常BT

问题：

- 需要网络环境非常好，室内或者野外空旷



#### Xirrus XD4-240

- Xirrus XD4-240 是有4个射频，其中2个是2.4g，两个是5g
- 每个射频仅能设置一个信道，而且单射频理论最大只能带240个设备，实际使用190个设备较为合适
- 每个SSID需要分配给射频，可以一个SSID分配给多个射频

问题：

- 如果4射频全是5g就完美了
- 设置复杂，全英文
- 启动比较慢



####  MikroTik NetBox 5 RB911G-5HPacD-NB

也是非常不错的，带个200，问题不大，只是信号比起triple稍微差了一点。



## Summary

其实看过了那么多家，Mikrotik算是最好的，硬件参数透明，软件是开源的ROS，每个设备的性能非常好评估，直接看参数就能真实的估计出来好坏。

目前看到的比较优秀的设备，设备基础是这样的，他们都是某个型号的CPU或者WIFI转发模块

- cpu QCA9557
- WLAN QCA 9892/9880

在这个配置下的AP，基本都能带了200以上，甚至300多

- cpu QCA9556 由于内存稍小,导致他实际带不了300+



也就是说基本只要看这个AP设备里的CPU和WIFI部分，就能看到这个芯片最高能达到的什么程度，有对比过一次以后，后面也只需要对应做芯片对比就能快速选择到更优的设备了。

国内的厂家就比较困难了，因为这里不透明，在不能直接拆解的情况，要对比芯片得到性能很难，而且国内的固件大都写了限制，导致参数和实际不符是常事（差距巨大）

同比ROS，本身开源，同时各种参数完全放出来，交给用户配置，除了门槛高，缺少现代化的设计界面，缺少类似UBNT的方便的AC管理软件以外，剩下基本都是完美。

当然这些都是在客户端不差的情况下进行对比的，如果客户端本身就不行，那AP再牛逼也不带不动。



国内的无线厂商，他们做产品规划的时候，每个产品都有自己的定位，而当你使用在一些特定场景的时候，基于他们产品本身就无法正常工作了。或许对于某个产品可以通过修改配置等等操作来适应环境，但这需要很强的专业性，多数厂家配备的技术支持本身并不能解决这种问题，有的甚至需要稍微修改一下固件。这种级别的技术支持甚至专向研发，没有任何一个厂家愿意给你做，你只能基于有限的设备中，找到一个勉强够用的，要优化到最好的程度，必须是自己做。



## Quote

> https://mikrotik.com/